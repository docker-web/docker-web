services:
  gitea:
    image: gitea/gitea
    container_name: gitea
    restart: always
    environment:
      GITEA__server__DOMAIN: "${DOMAIN}"
      GITEA__server__ROOT_URL: "${PROTO}://${DOMAIN}/"
      VIRTUAL_HOST: "${DOMAIN}"
      LETSENCRYPT_HOST: "${DOMAIN}"
    volumes:
      - gitea:/data
    networks:
      - dockerweb
    expose:
      - "3000"

  gitea-runner:
    image: gitea/act_runner:latest
    container_name: gitea-runner
    restart: always
    depends_on:
      - gitea
    volumes:
      - runner:/data
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      GITEA_INSTANCE_URL: "${PROTO}://${DOMAIN}"
      GITEA_RUNNER_REGISTRATION_TOKEN: "${RUNNER_TOKEN}"
    networks:
      - dockerweb

volumes:
  gitea:
  runner:

networks:
  dockerweb:
    external: true
